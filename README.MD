# ã‹ãªã‚²ãƒ¼ãƒ 

![kana](http://127.0.0.1:8080/markdown/kana.png)

> åœ¨çº¿ä½“éªŒåœ°å€ <https://dragonir.github.io/kanaApp/>

## ä»å¼€å‘ä¸€æ¬¾æ—¥è¯­äº”åéŸ³å°æ¸¸æˆè¿‡ç¨‹ä¸­å¯ä»¥å­¦åˆ°å“ªäº›å‰ç«¯çŸ¥è¯†

## èƒŒæ™¯

åœ¨å­¦ä¹ æ—¥è¯­çš„åˆæœŸé˜¶æ®µï¼Œæˆ‘å‘ç°æ—¥è¯­äº”åéŸ³çš„è®°å¿†å¹¶ä¸æ˜¯å¾ˆå®¹æ˜“çš„ï¼Œå¹³å‡åçš„è®°å¿†å°¤å…¶ä»¤äººè´¹ç¥ã€‚è¿™æ—¶æˆ‘æƒ³å¦‚æœæœ‰ä¸€ä¸ªåº”ç”¨å¯ä»¥å……åˆ†åˆ©ç”¨ç¢ç‰‡æ—¶é—´ï¼Œåœ¨åˆä¼‘æˆ–åœ°é“ä¸Šéšæ—¶å¯ä»¥ç»ƒä¹ è¯¥å¤šå¥½ã€‚äºæ˜¯æœéæ•´ä¸ªApp Storeï¼Œå•†åº—çš„è½¯ä»¶ä¸æ˜¯å«æœ‰å†…è´­ã€å¤¹å¸¦å¹¿å‘Šå°±æ˜¯åŠ¨è¾„40Mä»¥ä¸Šï¼Œæ²¡æ‰¾åˆ°ä¸€ä¸ªè‡ªå·±æ»¡æ„çš„åº”ç”¨ã€‚äºæ˜¯æ‰“ç®—è‡ªå·±é€ è½®å­å†™ä¸€ä¸ªï¼Œå› æ­¤æœ‰äº†è¯¥ç½‘é¡µåº”ç”¨å’Œæ–‡ç« çš„äº§ç”Ÿã€‚åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œä¸»è¦ä»‹ç»è‡ªå·±åœ¨å¼€å‘è¿™ä¸ªåº”ç”¨è¿‡ç¨‹ä¸­çš„æ”¶è·ã€‚

## å®ç°

### æ·±è‰²æ¨¡å¼

#### `prefers-color-scheme` åª’ä½“æŸ¥è¯¢

`prefers-color-scheme` åª’ä½“ç‰¹æ€§ç”¨äºæ£€æµ‹ç”¨æˆ·æ˜¯å¦æœ‰å°†ç³»ç»Ÿçš„ä¸»é¢˜è‰²è®¾ç½®ä¸ºäº®è‰²æˆ–è€…æš—è‰²ã€‚

è¯­æ³•

`@media (prefers-color-scheme: value) {}` å…¶ä¸­ `value` æœ‰ä»¥ä¸‹ `3` ç§å€¼ï¼Œå®ƒä»¬åˆ†åˆ«è¡¨ç¤ºï¼š

* `light`ï¼šè¡¨ç¤ºç”¨æˆ·ç³»ç»Ÿæ”¯æŒæ·±è‰²æ¨¡å¼ï¼Œå¹¶ä¸”å·²è®¾ç½®ä¸ºæµ…è‰²ä¸»é¢˜ï¼ˆé»˜è®¤å€¼ï¼‰ã€‚
* `dark`ï¼šè¡¨ç¤ºç”¨æˆ·ç³»ç»Ÿæ”¯æŒæ·±è‰²æ¨¡å¼ï¼Œå¹¶ä¸”å·²è®¾ç½®ä¸ºæ·±è‰²ä¸»é¢˜ã€‚
* `no-preference`ï¼šè¡¨ç¤ºç”¨æˆ·ç³»ç»Ÿä¸æ”¯æŒæ·±è‰²æ¨¡å¼æˆ–æ— æ³•å¾—çŸ¥æ˜¯å¦è®¾ç½®ä¸ºæ·±è‰²æ¨¡å¼ï¼ˆå·²åºŸå¼ƒï¼‰ã€‚

> è‹¥ç»“æœä¸º `no-preference`ï¼Œæ— æ³•é€šè¿‡æ­¤åª’ä½“ç‰¹æ€§è·çŸ¥å®¿ä¸»ç³»ç»Ÿæ˜¯å¦æ”¯æŒè®¾ç½®ä¸»é¢˜è‰²ï¼Œæˆ–è€…ç”¨æˆ·æ˜¯å¦ä¸»åŠ¨å°†å…¶è®¾ç½®ä¸ºæ— åå¥½ã€‚å‡ºäºéšç§ä¿æŠ¤ç­‰æ–¹é¢çš„è€ƒè™‘ï¼Œç”¨æˆ·æˆ–ç”¨æˆ·ä»£ç†ä¹Ÿå¯èƒ½åœ¨ä¸€äº›æƒ…å†µä¸‹åœ¨æµè§ˆå™¨å†…éƒ¨å°†å…¶è®¾ç½®ä¸º `no-preference`ã€‚

å¦‚ä»¥ä¸‹ä¾‹å­æ‰€ç¤ºï¼Œå½“ç³»ç»Ÿä¸»é¢˜è‰²ä¸ºæ·±è‰²æ—¶ `.demo` å…ƒç´ çš„èƒŒæ™¯è‰²ä¸º `#FFFFFF`ï¼›å½“ç³»ç»Ÿä¸»é¢˜è‰²ä¸ºæµ…è‰²æ—¶ï¼Œ`.demo` å…ƒç´ çš„èƒŒæ™¯è‰²ä¸º `#000000`ã€‚

```css
@media (prefers-color-scheme: dark) {
  .demo { background:  #FFFFFF; }
}
@media (prefers-color-scheme: light) {
  .demo { background: #000000; }
}
```

#### `JavaScript` åˆ¤æ–­æ·±è‰²æ¨¡å¼

`window.matchMedia()` æ–¹æ³•è¿”å›ä¸€ä¸ªæ–°çš„ `MediaQueryList` å¯¹è±¡ï¼Œè¡¨ç¤ºæŒ‡å®šçš„åª’ä½“æŸ¥è¯¢ `(en-US)å­—ç¬¦ä¸²` è§£æåçš„ç»“æœã€‚è¿”å›çš„ `MediaQueryList` å¯è¢«ç”¨äºåˆ¤å®š `Document` æ˜¯å¦åŒ¹é…åª’ä½“æŸ¥è¯¢ï¼Œæˆ–è€…ç›‘æ§ä¸€ä¸ª `document` æ¥åˆ¤å®šå®ƒåŒ¹é…äº†æˆ–è€…åœæ­¢åŒ¹é…äº†æ­¤åª’ä½“æŸ¥è¯¢ã€‚å…¶ä¸­ `MediaQueryList` å¯¹è±¡å…·æœ‰å±æ€§ `matches`å’Œ `media`ï¼Œæ–¹æ³• `addListener` å’Œ `removeListener`ã€‚

ä½¿ç”¨matchMediaä½œä¸ºåˆ¤æ–­åª’ä»‹ï¼Œä¹Ÿå¯ä»¥è¯†åˆ«ç³»ç»Ÿæ˜¯å¦æ”¯æŒä¸»é¢˜è‰²ï¼š

```js
if (window.matchMedia('(prefers-color-scheme)').media === 'not all') {
  // æµè§ˆå™¨ä¸æ”¯æŒä¸»é¢˜è‰²è®¾ç½®
}
if (window.matchMedia('(prefers-color-scheme: dark)').matches){
  // æ·±è‰²æ¨¡å¼
} else {
  // æµ…è‰²æ¨¡å¼
}
```

å¦å¤–è¿˜å¯ä»¥åŠ¨æ€ç›‘å¬ç³»ç»Ÿæ·±è‰²æ¨¡å¼çš„çŠ¶æ€ï¼Œæ ¹æ®ç³»ç»Ÿæ·±è‰²æ¨¡å¼çš„åˆ‡æ¢åšå‡ºå®æ—¶å“åº”ï¼š

```js
window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
  if (e.matches) { /* å¼€å¯æ·±è‰²æ¨¡å¼ */ }
  else { /* å…³é—­æ·±è‰²æ¨¡å¼ */ }
});

// æˆ–
const listeners = {
  dark: (mediaQueryList) => {
    if (mediaQueryList.matches) { /* å¼€å¯æ·±è‰²æ¨¡å¼ */ }
  },
  light: (mediaQueryList) => {
    if (mediaQueryList.matches) { /* å¼€å¯æµ…è‰²æ¨¡å¼ */ }
  }
};
window.matchMedia('(prefers-color-scheme: dark)').addListener(listeners.dark);
window.matchMedia('(prefers-color-scheme: light)').addListener(listeners.light);
```

#### `HTML` å…ƒç´ ä¸­åˆ¤æ–­

`picture` å…ƒç´ å…è®¸æˆ‘ä»¬åœ¨ä¸åŒçš„è®¾å¤‡ä¸Šæ˜¾ç¤ºä¸åŒçš„å›¾ç‰‡ï¼Œä¸€èˆ¬ç”¨äºå“åº”å¼ã€‚
`HTML5` å¼•å…¥äº† `<picture>` å…ƒç´ ï¼Œè¯¥å…ƒç´ å¯ä»¥è®©å›¾ç‰‡èµ„æºçš„è°ƒæ•´æ›´åŠ çµæ´»ã€‚
`<picture>` å…ƒç´ é›¶æˆ–å¤šä¸ª `<source>` å…ƒç´ å’Œä¸€ä¸ª `<img>` å…ƒç´ ï¼Œæ¯ä¸ª `<source>` å…ƒç´ åŒ¹é…ä¸åŒçš„è®¾å¤‡å¹¶å¼•ç”¨ä¸åŒçš„å›¾åƒæºï¼Œå¦‚æœæ²¡æœ‰åŒ¹é…çš„ï¼Œå°±é€‰æ‹© `<img>` å…ƒç´ çš„ src å±æ€§ä¸­çš„ urlã€‚

```html
<picture>
  <source srcset="dark.png" media="(prefers-color-scheme: dark)">
  <img src="light.png">
</picture>
```

> æ³¨æ„:`<img>` å…ƒç´ æ˜¯æ”¾åœ¨æœ€åä¸€ä¸ª `<picture>` å…ƒç´ ä¹‹åï¼Œå¦‚æœæµè§ˆå™¨ä¸æ”¯æŒè¯¥å±æ€§åˆ™æ˜¾ç¤º `<img>` å…ƒç´ çš„çš„å›¾ç‰‡ã€‚

> Darkmode.js GitHub å¼€æºé¡¹ç›® Darkmode.jsï¼Œé€šè¿‡ CSS å±æ€§ mix-blend-mode æš´åŠ›å®ç°æ·±è‰²æ¨¡å¼ï¼Œç°åœ¨å®ƒæœ‰ 2.2k Starã€‚mix-blend-mode æè¿°å½“å‰å…ƒç´ çš„å†…å®¹åº”è¯¥ä¸å½“å‰å…ƒç´ çš„ç›´ç³»çˆ¶å…ƒç´ çš„å†…å®¹å’Œå…ƒç´ çš„èƒŒæ™¯å¦‚ä½•æ··åˆï¼Œå€¼ä¸º difference æ—¶å³â€œåç›¸â€ã€‚

### ç¦»çº¿ç¼“å­˜

https://www.cnblogs.com/yangyangxxb/p/9964959.html
https://zhuanlan.zhihu.com/p/144512343

### æ¨±èŠ±é£˜è½æ•ˆæœ

```html
<div id="petals_container">
  <div class="petal"></div>
  <div class="petal"></div>
  <div class="petal"></div>
  <div class="petal"></div>
  <div class="petal"></div>
  <div class="petal"></div>
  <div class="petal"></div>
  <div class="petal"></div>
  <div class="petal"></div>
  <div class="petal"></div>
  <div class="petal"></div>
  <div class="petal"></div>
  <div class="petal"></div>
  <div class="petal"></div>
  <div class="petal"></div>
</div>
```

```css
.petal {
  width: 1rem;
  height: 1rem;
  display: inline-block;
  position: absolute;
  top: -10rem;
  bottom: 0;
  z-index: 150;
}
.petal .rotate {
  animation: driftyRotate 1s infinite both ease-in-out;
  perspective: 1000;
}
.petal .askew {
  background: currentColor;
  transform: skewY(10deg);
  display: block;
  width: 2rem;
  height: 2rem;
  animation: drifty 1s infinite alternate both ease-in-out;
  perspective: 1000;
}
.petal {
  color: rgba(0, 0, 0, 0);
}
.petal:nth-of-type(7n) .askew {
  animation-delay: -.6s;
  animation-duration: 2.25s;
}
.petal:nth-of-type(7n + 1) .askew {
  animation-delay: -.879s;
  animation-duration: 3.5s;
}
.petal:nth-of-type(7n + 2) .askew {
  animation-delay: -.11s;
  animation-duration: 1.95s;
}
.petal:nth-of-type(7n + 3) .askew {
  animation-delay: -.246s;
  animation-duration: .85s;
}
.petal:nth-of-type(7n + 4) .askew {
  animation-delay: -.43s;
  animation-duration: 2.5s;
}
.petal:nth-of-type(7n + 5) .askew {
  animation-delay: -.56s;
  animation-duration: 1.75s;
}
.petal:nth-of-type(7n + 6) .askew {
  animation-delay: -.76s;
  animation-duration: 1.5s;
}
.petal:nth-of-type(9n) .rotate {
  animation-duration: 2s;
}
.petal:nth-of-type(9n + 1) .rotate {
  animation-duration: 2.3s;
}
.petal:nth-of-type(9n + 2) .rotate {
  animation-duration: 1.1s;
}
.petal:nth-of-type(9n + 3) .rotate {
  animation-duration: .75s;
}
.petal:nth-of-type(9n + 4) .rotate {
  animation-duration: 4.3s;
}
.petal:nth-of-type(9n + 5) .rotate {
  animation-duration: 3.05s;
}
.petal:nth-of-type(9n + 6) .rotate {
  animation-duration: 2.76s;
}
.petal:nth-of-type(9n + 7) .rotate {
  animation-duration: 7.6s;
}
.petal:nth-of-type(9n + 8) .rotate {
  animation-duration: 1.78s;
}
@keyframes drifty {
  0% {
    transform: skewY(10deg) translate3d(-250%, 0, 0);
    display: block;
  }
  100% {
    transform: skewY(-12deg) translate3d(250%, 0, 0);
    display: block;
  }
}
@keyframes driftyRotate {
  0% {
    transform: rotateX(0);
    display: block;
  }
  100% {
    transform: rotateX(359deg);
    display: block;
  }
}
```

```js
var petalPlayers = [];
function animatePetals() {
  var petals = document.querySelectorAll('.petal');
  if (!petals[0].animate) {
    var petalsContainer = document.getElementById('petals_container');
    return false;
  }
  for (var i = 0, len = petals.length; i < len; ++i) {
    var petal = petals[i];
    petal.innerHTML = '<div class="rotate"><img src="data:image/png;base64,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" class="askew"></div>';
    var scale = Math.random() * .6 + .2;
    var player = petal.animate([{
        transform: 'translate3d(' + (i / len * 100) + 'vw,0,0) scale(' + scale + ')',
        opacity: scale
      },
      {
        transform: 'translate3d(' + (i / len * 100 + 10) + 'vw,150vh,0) scale(' + scale + ')',
        opacity: 1
      }
    ], {
      duration: Math.random() * 90000 + 8000,
      iterations: Infinity,
      delay: -(Math.random() * 5000)
    });
    petalPlayers.push(player);
  }
}
animatePetals();
```

### Photoshop æŠ€èƒ½

#### logoè®¾è®¡

## å‚è€ƒèµ„æ–™

* <https://webkit.org/blog/8840/dark-mode-support-in-webkit>

## TODO

* æ¨±èŠ±æ•ˆæœ
* æ ·å¼ä¼˜åŒ–
* âœ” PWA ä¿å­˜åˆ°æ¡Œé¢
* âœ” æ·±è‰²æµ…è‰²æ¨¡å¼æ›¿æ¢
* ç¤¼ç‚®åº†ç¥æ•ˆæœğŸ‰